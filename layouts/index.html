{{ define "header" }}
<div class="headerContainer home">
  <!-- TODO(spencer): insert kaleidescope here? -->
  <h1 id="siteTitle">
    hi! i'm spencer
    {{ partial "personal_emoji.html" }}
  </h1>
  <div class="description">
    {{.Content}}
  </div>
  {{ partial "social_media.html" . }}
  <iframe class="subscribe" src="https://spencerchang.substack.com/embed" style="border:1px solid #EEE; background:white;" frameborder="0" scrolling="no"></iframe>
</div>
{{ end }} 
{{ define "main" }}
<!-- TODO: replace this with kaleidoscope or feral.earth stuff -->
<div class="summaryList">
  <div class="writing hidden">
    <div class="sectionHeader">
      <h2>some favorite creations</h2>
        <div class="arrows">
          <button class="link" onclick="navBackward()"><i class="uis uis-arrow-circle-left" alt="←"></i></button><button class="link" onclick="navForward()"><i class="uis uis-arrow-circle-right" alt="→"></i></button>
        </div>
    </div>
    <div class="postsList">
      {{ $highlights := where .Site.RegularPages "Params.featured" true }}
      <!-- TODO: this comlement doesn't quite work. I hate HUGO -->
      {{ range first 5 $highlights  }}
        {{ .Render "compact_summary" }} 
      {{ end }}
    </div>
  </div>
  <div class="projects hidden">
    <div class="sectionHeader">
      <h2>some favorite projects</h2>
        <div class="arrows">
          <button class="link" onclick="navBackward()"><i class="uis uis-arrow-circle-left" alt="←"></i></button><button class="link" onclick="navForward()"><i class="uis uis-arrow-circle-right" alt="→"></i></button>
        </div>
    </div>
      <div class="postsList">
      {{ $favorite := slice "favorite" }}
      {{ $project := slice "projects" }}
      {{ $favorites := where .Site.RegularPages "Params.tags" "intersect" $favorite }}
      {{ $projects := where .Site.RegularPages "Params.tags" "intersect" $project }}
      {{ $faveProjects := intersect $favorites $projects | complement $highlights }}
      {{ $intersectedProjects := intersect $favorites $projects | intersect $highlights }}
      {{ range first 5 ($faveProjects | append $intersectedProjects) }}
        {{ .Render "compact_summary" }} 
      {{ end }}
      <br/>
      Check out <a href="/projects">all my projects</a>.
    </div>
  </div>
  <div class="projects hidden">
    <div class="sectionHeader">
      <h2>some favorite writing</h2>
        <div class="arrows">
          <button class="link" onclick="navBackward()"><i class="uis uis-arrow-circle-left" alt="←"></i></button><button class="link" onclick="navForward()"><i class="uis uis-arrow-circle-right" alt="→"></i></button>
        </div>
    </div>
      <div class="postsList">
      {{ $favorite := slice "favorite" }}
      {{ $favorites := (where .Site.RegularPages "Params.tags" "intersect" $favorite) | complement $highlights $projects }}
      {{ $intersectedWriting := $favorites | intersect $highlights }}
      {{ range first 5 ($favorites | append $intersectedWriting)  }}
        {{ .Render "compact_summary" }} 
      {{ end }}
      <br/>
      Check out <a href="/posts">all my writing</a>.
    </div>
  </div>
  <div class="recentReleases hidden">
    <div class="sectionHeader">
      <h2>some recent releases</h3>
        <div class="arrows">
          <button class="link" onclick="navBackward()"><i class="uis uis-arrow-circle-left" alt="←"></i></button><button class="link" onclick="navForward()"><i class="uis uis-arrow-circle-right" alt="→"></i></button>
        </div>
    </div>
    <div class="postsList">
      {{ $recentCands := .Site.RegularPages.ByDate.Reverse }}
      {{ range first 5 $recentCands  }}
        {{ .Render "compact_summary" }} 
      {{ end }}
    </div>
  </div>
</div>
<script>
  let summaryIdx = 0;
  const listElement = document.querySelector('.summaryList')
  const items = listElement.children;
  const total = items.length;

  const hammer = new Hammer(listElement, {
    recognizers: [[Hammer.Swipe, { direction: Hammer.DIRECTION_ALL }]],
  });

  hammer.on("swipeleft", () => {
    navForward();
  });
  hammer.on("swiperight", () => {
    navBackward();
  });

  const navForward = () => {
    hideEleAtIdx();
    summaryIdx = (summaryIdx + 1) % total;
    renderEleAtIdx();
  };
  const navBackward = () => {
    hideEleAtIdx();
    summaryIdx = summaryIdx === 0 ? total - 1 : (summaryIdx - 1) % total;
    renderEleAtIdx();
  };

  const hideEleAtIdx = () => {
    items[summaryIdx].classList.add('hidden');
  }
  const renderEleAtIdx = () => {
    items[summaryIdx].classList.remove('hidden');
  }

  renderEleAtIdx(summaryIdx);
</script>
{{ end }}
