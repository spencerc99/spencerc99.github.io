{{ define "header" }}
<div class="headerContainer home">
  <!-- TODO(spencer): insert kaleidescope here? -->
  <h1 id="siteTitle">
    hi! i'm spencer
    {{ partial "personal_emoji.html" }}
  </h1>
  <div class="description">
    {{.Content}}
  </div>
  {{ partial "social_media.html" . }}
  <iframe class="subscribe" src="https://spencerchang.substack.com/embed" style="border:1px solid #EEE; background:white;" frameborder="0" scrolling="no"></iframe>
</div>
{{ end }} 
{{ define "main" }}
<!-- TODO: replace this with kaleidoscope or feral.earth stuff -->
<div class="summaryList">
  <!-- TODO: make this a tab -->
  <div class="tabs">
    <button onclick="setTab(0)"><h3>recent</h3></button>
    <button onclick="setTab(1)"><h3>faves</h3></button>
    <button onclick="setTab(2)"><h3>projects</h3></button>
    <button onclick="setTab(3)"><h3>writing</h3></button>
  </div>
  <div class="tabContent">

    <div class="recentReleases hidden">
      <div class="postsList">
        <div style="margin-top: 8px;"><i class="meta">subscribe <a href="https://spencerchang.substack.com/subscribe">above</a> to get updates on my releases</i></div>
        {{ $recentCands := .Site.RegularPages.ByDate.Reverse }}
        {{ range first 10 $recentCands  }}
          {{ .Render "compact_summary" }} 
        {{ end }}
      </div>
    </div>
    <div class="faves hidden">
      <div class="postsList">
        {{ $highlights := where .Site.RegularPages "Params.featured" true }}
        <!-- TODO: this comlement doesn't quite work. I hate HUGO -->
        {{ range first 5 $highlights  }}
          {{ .Render "compact_summary" }} 
        {{ end }}
      </div>
    </div>
    <div class="writing hidden">
        <div class="postsList">
        {{ $favorite := slice "favorite" }}        {{ $project := slice "projects" }}
        {{ $favorites := where .Site.RegularPages "Params.tags" "intersect" $favorite }}
        {{ $projects := where .Site.RegularPages "Params.tags" "intersect" $project }}
        {{ $faveProjects := intersect $favorites $projects | complement $highlights }}
        {{ $intersectedProjects := intersect $favorites $projects | intersect $highlights }}
        {{ range first 5 ($faveProjects | append $intersectedProjects) }}
          {{ .Render "compact_summary" }} 
        {{ end }}
        <br/>
        Check out <a href="/projects">all my projects</a>.
      </div>
    </div>
    <div class="projects hidden">
        <div class="postsList">
        {{ $favorite := slice "favorite" }}
        {{ $favorites := (where .Site.RegularPages "Params.tags" "intersect" $favorite) | complement $highlights $projects }}
        {{ $intersectedWriting := $favorites | intersect $highlights }}        {{ range first 5 ($favorites | append $intersectedWriting)  }}
          {{ .Render "compact_summary" }} 
        {{ end }}
        <br/>
        Check out <a href="/posts">all my writing</a>.
      </div>
    </div>
  </div>
</div>
{{ $stream := getJSON "https://status.spencerchang.me/api/me" }}
<div class="marquee">
  <span>
  {{ range $index, $element := $stream }}
    [{{ lang.FormatNumberCustom 0 $element.birthdayEpoch "- ." }}]  {{ $element.displayHTML | safeHTML}} •  
  {{ end }}
  {{ range $index, $element := $stream }}
    [{{ lang.FormatNumberCustom 0 $element.birthdayEpoch "- ." }}]  {{ $element.displayHTML | safeHTML}} •  
  {{ end }}
</span>
</div>

<script>
  let summaryIdx = 0;
  const listElement = document.querySelector('.tabContent')
  const items = listElement.children;
  const tabs = document.querySelector('.tabs').children;
  const total = items.length;

  if ("ontouchstart" in document.documentElement) {
    const hammer = new Hammer(listElement, {
      recognizers: [[Hammer.Swipe, { direction: Hammer.DIRECTION_HORIZONTAL }]],
    });

    hammer.on("swipeleft", () => {
      navForward();
    });
    hammer.on("swiperight", () => {
      navBackward();
    });
  }

  const navForward = () => {
    hideEleAtIdx();
    summaryIdx = (summaryIdx + 1) % total;
    renderEleAtIdx();
  };
  const navBackward = () => {
    hideEleAtIdx();
    summaryIdx = summaryIdx === 0 ? total - 1 : (summaryIdx - 1) % total;
    renderEleAtIdx();
  };

  const hideEleAtIdx = () => {
    items[summaryIdx].classList.add('hidden');
    tabs[summaryIdx].classList.remove('active');
  }
  const renderEleAtIdx = () => {
    items[summaryIdx].classList.remove('hidden');
    tabs[summaryIdx].classList.add('active');
  }

  const setTab = (idx) => {
    hideEleAtIdx(summaryIdx);
    summaryIdx = idx;
    renderEleAtIdx(summaryIdx);
  }

  renderEleAtIdx(summaryIdx);
</script>
{{ end }}
